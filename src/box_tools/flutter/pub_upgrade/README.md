# box_pub_upgrade

`box_pub_upgrade` ç”¨äºå‡çº§ Flutter é¡¹ç›® `pubspec.yaml` ä¸­çš„**ç§æœ‰ hosted/url ä¾èµ–**ç‰ˆæœ¬ï¼š  
å…ˆæ ¹æ® `pub outdated --json` ç”Ÿæˆå‡çº§æ¸…å•ï¼Œå±•ç¤ºå·®å¼‚å¹¶äºŒæ¬¡ç¡®è®¤ï¼Œç„¶åæ›´æ–° `pubspec.yaml` / `pubspec.lock`ï¼Œæœ€åå¯é€‰è‡ªåŠ¨ `git add/commit/push`ã€‚

æ ¸å¿ƒè§„åˆ™ï¼š**ä¸è·¨ next minor**ã€‚  
ä¾‹å¦‚é¡¹ç›®ç‰ˆæœ¬ä¸º `3.45.*`ï¼Œä¾èµ–åªå…è®¸å‡çº§åˆ° `< 3.46.0`ï¼ˆåŒ minor å†…å¯å‡çº§åˆ°æœ€æ–° patchï¼‰ã€‚

---

## å®‰è£…

éšå·¥å…·é›†ä¸€èµ·å®‰è£…ã€‚

```sh
box_pub_upgrade --help
```

---

## å¿«é€Ÿå¼€å§‹

äº¤äº’æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰ï¼š

```sh
box_pub_upgrade
```

è‡ªåŠ¨ç¡®è®¤å¹¶æ‰§è¡Œï¼ˆä¸å†è¯¢é—®ï¼‰ï¼š

```sh
box_pub_upgrade --yes
```

åªæ›´æ–°ä¾èµ–ä¸ lockï¼Œä¸æ‰§è¡Œ gitï¼š

```sh
box_pub_upgrade --no-commit
```

---

## å·¥ä½œæµç¨‹

1. æ£€æµ‹å½“å‰ç›®å½•æ˜¯å¦å­˜åœ¨ `pubspec.yaml`
2. ï¼ˆè‹¥å­˜åœ¨è¿œç«¯åˆ†æ”¯ï¼‰`git pull --ff-only`
3. æ‰§è¡Œ `flutter pub get`
4. æ‰§è¡Œ `flutter pub outdated --json`ï¼ˆæˆ–å›é€€å°è¯• `dart pub outdated --json`ï¼‰
5. ä» `pubspec.yaml` è§£æå‡ºæ‰€æœ‰ä¾èµ–å—ï¼Œå¹¶ç­›å‡ºâ€œç§æœ‰ hosted/url ä¾èµ–â€
6. ç”Ÿæˆå‡çº§è®¡åˆ’ï¼šä¸ºæ¯ä¸ªå¯å‡çº§ä¾èµ–é€‰æ‹©ä¸€ä¸ª**ç¬¦åˆè§„åˆ™çš„ç›®æ ‡ç‰ˆæœ¬**
7. å±•ç¤ºæ¸…å• â†’ ç”¨æˆ·ç¡®è®¤ï¼ˆæˆ– `--yes` è·³è¿‡ï¼‰
8. å†™å› `pubspec.yaml`ï¼ˆä»…æ”¹ç›®æ ‡ä¾èµ–çš„ç‰ˆæœ¬è¡Œï¼‰
9. å†æ¬¡æ‰§è¡Œ `flutter pub get` æ›´æ–° `pubspec.lock`
10. ï¼ˆé»˜è®¤å¼€å¯ï¼‰`git add pubspec.yaml pubspec.lock` â†’ `git commit` â†’ `git push`

---

## ç§æœ‰ä¾èµ–è¯†åˆ«è§„åˆ™

é»˜è®¤ï¼šåªè¦ä¾èµ–å—åŒ…å« `hosted:` å¹¶ä¸”å­˜åœ¨ `url:`ï¼Œå°±è§†ä¸ºç§æœ‰ä¾èµ–ï¼Œä¾‹å¦‚ï¼š

```yaml
dependencies:
  my_pkg:
    hosted:
      name: my_pkg
      url: https://dart.cloudsmith.io/xxx/xxx/
    version: ^1.2.3
```

å¦‚æœä½ æŒ‡å®šäº† `--private-host`ï¼Œåˆ™åªæœ‰å½“ `url` å‘½ä¸­ä»»ä¸€å…³é”®å­—æ—¶æ‰ä¼šè¢«å‡çº§ï¼š

```sh
box_pub_upgrade --private-host dart.cloudsmith.io --private-host my.private.repo
```

---

## å‡çº§ä¸Šé™è§„åˆ™ï¼ˆä¸è·¨ next minorï¼‰

å·¥å…·ä¼šè¯»å– `pubspec.yaml` é¡¶å±‚çš„ `version:`ï¼ˆåº”ç”¨ç‰ˆæœ¬ï¼‰ï¼Œä¾‹å¦‚ï¼š

```yaml
version: 3.45.1+2026011900
```

å¹¶è®¡ç®—ä¸Šé™ï¼š`< 3.46.0`ã€‚

- **å…è®¸**ä¾èµ–å‡çº§åˆ° `3.45.x` ä¸­çš„æ›´é«˜ patchï¼ˆå¦‚ `3.45.10`ï¼‰
- **ä¸å…è®¸**ä¾èµ–å‡çº§åˆ° `3.46.0` æˆ–æ›´é«˜

å¦‚æœæ— æ³•è§£æåº”ç”¨ç‰ˆæœ¬ï¼ˆç¼ºå°‘ version æˆ–æ ¼å¼å¼‚å¸¸ï¼‰ï¼Œä¼šé€€åŒ–ä¸ºï¼š**ä¸å‡çº§ä¾èµ–å¤§ç‰ˆæœ¬**ï¼ˆmajor ä¸å˜ï¼‰ã€‚

---

## è·³è¿‡æŒ‡å®šä¾èµ–

é»˜è®¤ä¼šè·³è¿‡ï¼š`ap_recaptcha`

ä½ ä¹Ÿå¯ä»¥è¿½åŠ å¤šä¸ª `--skip`ï¼š

```sh
box_pub_upgrade --skip ap_recaptcha --skip some_pkg
```

---

## Git æäº¤

é»˜è®¤ä¼šåœ¨å‡çº§åæ‰§è¡Œï¼š

- `git add pubspec.yaml pubspec.lock`
- `git commit -m "<commit_message>\n\n<summary...>"`
- è‹¥å½“å‰åˆ†æ”¯å­˜åœ¨è¿œç«¯åŒååˆ†æ”¯ï¼š`git push`

ä½ å¯ä»¥é€šè¿‡ `--no-commit` å®Œå…¨è·³è¿‡ gitï¼š

```sh
box_pub_upgrade --no-commit
```

### commit message

ä½ç½®å‚æ•° `commit_message` å¯é€‰ï¼Œé»˜è®¤æ˜¯ `up deps`ï¼š

```sh
box_pub_upgrade "chore(deps): upgrade private hosted deps"
```

æäº¤æ­£æ–‡ä¼šè‡ªåŠ¨è¿½åŠ å‡çº§æ‘˜è¦ï¼ˆæ¯ä¸ªä¾èµ–ä¸€è¡Œï¼‰ã€‚

---

## ç¤ºä¾‹è¾“å‡º

```text
ğŸ“Œ é¡¹ç›®ç‰ˆæœ¬ï¼š3.45.1+2026011900ï¼Œä¾èµ–å‡çº§ä¸Šé™ï¼š<3.46.0ï¼ˆå…è®¸å‡åˆ°åŒ minor çš„æœ€æ–° patchï¼‰

å‘ç°ä»¥ä¸‹å¯å‡çº§ä¾èµ–ï¼ˆlatest è¡¨ç¤ºé€‰å®šç›®æ ‡ç‰ˆæœ¬ï¼‰ï¼š
  - foo: ^3.45.1 -> 3.45.8
  - bar:  1.2.0  -> 1.2.3

æ˜¯å¦æ‰§è¡Œå‡çº§ï¼Ÿ(y/N):
```

---

## è¿”å›ç ï¼ˆExit Codesï¼‰

| è¿”å›ç  | å«ä¹‰ |
| --- | --- |
| 0 | æˆåŠŸ / æ— éœ€å‡çº§ / ç”¨æˆ·å–æ¶ˆ |
| 1 | å¤±è´¥ï¼ˆä¾‹å¦‚ git pull / pub outdated / pub get å¤±è´¥ï¼‰ |
| 130 | ç”¨æˆ· Ctrl+C å–æ¶ˆ |

---

## æ³¨æ„äº‹é¡¹

- è¯·åœ¨ Flutter é¡¹ç›®æ ¹ç›®å½•ï¼ˆå­˜åœ¨ `pubspec.yaml`ï¼‰è¿è¡Œã€‚
- `git pull --ff-only` å¯èƒ½å› ä¸ºåˆ†å‰å¤±è´¥ï¼ˆéœ€è¦ä½ æ‰‹åŠ¨ rebase/mergeï¼‰ã€‚
- ç‰ˆæœ¬æ¯”è¾ƒä¼šå¿½ç•¥ `^`ã€`-pre`ã€`+build` çš„å…ƒä¿¡æ¯ï¼Œä»…æ¯”è¾ƒæ•°å­—éƒ¨åˆ†ã€‚
