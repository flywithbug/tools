# pub_upgrade

`pub_upgrade` æ˜¯ä¸€ä¸ª Flutter ç§æœä¾èµ–å‡çº§å·¥å…·ã€‚

å®ƒä¼šè¯»å–é¡¹ç›® `pubspec.yaml` ä¸­å£°æ˜ä¸º **hosted + url** çš„ç§æœ‰ä¾èµ–ï¼Œé€šè¿‡  
`flutter pub outdated --json` åˆ†æå¯å‡çº§ç‰ˆæœ¬ï¼Œå¹¶åœ¨ **ä¸è·¨è¶Šä¸‹ä¸€ minor ç‰ˆæœ¬** çš„å‰æä¸‹ï¼Œè‡ªåŠ¨é€‰æ‹©**å¯å‡çº§çš„æœ€é«˜ç‰ˆæœ¬**ï¼Œå†ç”±ä½ ç¡®è®¤æ˜¯å¦æ‰§è¡Œå‡çº§ã€‚

---

## æ ¸å¿ƒè®¾è®¡ç›®æ ‡

`pub_upgrade` è§£å†³çš„æ˜¯ä¸€ä¸ªç°å®é—®é¢˜ï¼š

> **é¡¹ç›®æœ¬èº«è¿˜åœ¨ 3.45.x ç”Ÿå‘½å‘¨æœŸå†…ï¼Œä½† pub ä¸Šå·²ç»å‘å¸ƒäº† 3.46.0ï¼Œ  
æˆ‘ä»¬å¸Œæœ›ä¾èµ–èƒ½å‡çº§åˆ° 3.45.* çš„æœ€æ–° patchï¼Œä½†ç»ä¸èƒ½è¶Šç•Œã€‚**

å› æ­¤ï¼Œå®ƒçš„æ ¸å¿ƒè§„åˆ™æ˜¯ï¼š

> **ä¾èµ–å‡çº§å…è®¸é«˜äºå½“å‰ app versionï¼Œä½†å¿…é¡» `< ä¸‹ä¸€ minor.0`**

---

## å‡çº§ä¸Šé™è§„åˆ™ï¼ˆéå¸¸é‡è¦ï¼‰

`pub_upgrade` ä¼šè¯»å– `pubspec.yaml` é¡¶å±‚çš„ `version` å­—æ®µï¼Œä¾‹å¦‚ï¼š

```yaml
version: 3.45.1
```

æˆ–ï¼š

```yaml
version: 3.45.0+2026011900
```

ç„¶åè‡ªåŠ¨è®¡ç®— **ä¸¥æ ¼å‡çº§ä¸Šé™ï¼ˆexclusiveï¼‰**ï¼š

```text
app version = 3.45.x
å‡çº§ä¸Šé™ = < 3.46.0
```

### å‡çº§è§„åˆ™æ€»ç»“

| åœºæ™¯ | æ˜¯å¦å…è®¸ |
|----|----|
| 3.45.1 â†’ 3.45.10 | âœ… å…è®¸ |
| 3.45.0 â†’ 3.45.99 | âœ… å…è®¸ |
| 3.45.9 â†’ 3.46.0 | âŒ ä¸å…è®¸ |
| 3.45.9 â†’ 3.46.1 | âŒ ä¸å…è®¸ |

> æ¢å¥è¯è¯´ï¼š  
> **å‡çº§åªå…è®¸å‘ç”Ÿåœ¨åŒä¸€ä¸ª `major.minor` ä¹‹å†…ï¼ˆpatch è‡ªç”±ï¼‰ï¼Œä¸èƒ½è·¨ minorã€‚**

---

## ç§æœ‰ä¾èµ–è¯†åˆ«è§„åˆ™

`pub_upgrade` **ä¸å†ä¾èµ–åŸŸåå‰ç¼€æˆ–åŒ…åè§„åˆ™**ã€‚

åªè¦ä¾èµ–åœ¨ `pubspec.yaml` ä¸­ç¬¦åˆä»¥ä¸‹ç»“æ„ï¼Œå°±ä¼šè¢«è§†ä¸ºâ€œç§æœ‰ hosted ä¾èµ–â€ï¼š

```yaml
dependencies:
  ap_device:
    hosted:
      url: https://some.private.repo/app/
      name: ap_device
    version: ^2.1.11
```

### åˆ¤æ–­æ¡ä»¶

- å¿…é¡»æ˜¯ `hosted`
- å¿…é¡»å­˜åœ¨ `url`
- **é»˜è®¤ä¸é™åˆ¶åŸŸå**

ä½ å¯ä»¥é€šè¿‡å‚æ•° **ä¸»åŠ¨é™åˆ¶ç§æœåŸŸå**ï¼ˆå¯é€‰ï¼‰ï¼š

```bash
pub_upgrade --private-host dart.cloudsmith.io --private-host my.private.repo
```

---

## å®‰è£…ä¸ä½¿ç”¨å‰æ

- åœ¨ Flutter é¡¹ç›®æ ¹ç›®å½•è¿è¡Œï¼ˆåŒçº§å­˜åœ¨ `pubspec.yaml`ï¼‰
- æœ¬æœºå·²å®‰è£… `flutter`ï¼Œå¹¶åœ¨ `PATH` ä¸­
- é¡¹ç›®ä½¿ç”¨ Gitï¼ˆé»˜è®¤ä¼šè‡ªåŠ¨æäº¤ï¼Œå¯ç”¨ `--no-commit` è·³è¿‡ï¼‰

---

## å¿«é€Ÿå¼€å§‹

### äº¤äº’æ¨¡å¼ï¼ˆæ¨èï¼‰

```bash
pub_upgrade
```

æ‰§è¡Œæµç¨‹ï¼š

1. æ‰§è¡Œ `flutter pub get`
2. æ‰§è¡Œ `flutter pub outdated --json`
3. è§£æ **current / upgradable / resolvable / latest**
4. åœ¨ `< ä¸‹ä¸€ minor.0` çš„çº¦æŸä¸‹ï¼Œé€‰å‡º**æœ€é«˜å¯å‡çº§ç‰ˆæœ¬**
5. è¾“å‡ºå‡çº§æ¸…å•
6. è¯¢é—®æ˜¯å¦æ‰§è¡Œ
7. æ‰§è¡Œå‡çº§å¹¶å†æ¬¡ `flutter pub get`
8. é»˜è®¤æ‰§è¡Œ git commit / push

---

## å‡çº§ç‰ˆæœ¬é€‰æ‹©ç­–ç•¥ï¼ˆå†…éƒ¨é€»è¾‘ï¼‰

å¯¹äºæ¯ä¸ªç§æœ‰ä¾èµ–ï¼Œå€™é€‰ç‰ˆæœ¬æ¥æºä¸ºï¼š

- `upgradable.version`
- `resolvable.version`
- `latest.version`

ç„¶åï¼š

1. è¿‡æ»¤æ‰æ‰€æœ‰ `>= ä¸Šé™ï¼ˆä¾‹å¦‚ 3.46.0ï¼‰` çš„ç‰ˆæœ¬
2. åœ¨å‰©ä½™ç‰ˆæœ¬ä¸­é€‰ **æœ€å¤§çš„ä¸€ä¸ª**
3. è‹¥è¯¥ç‰ˆæœ¬ `> current`ï¼Œåˆ™åŠ å…¥å‡çº§è®¡åˆ’

è¿™èƒ½æ­£ç¡®å¤„ç†ä»¥ä¸‹æƒ…å†µï¼š

> `latest = 3.46.0`  
> ä½† `upgradable = 3.45.10`  
> ğŸ‘‰ **æœ€ç»ˆä¼šå‡çº§åˆ° 3.45.10**

---

## å¸¸ç”¨å‘½ä»¤

### è·³è¿‡ç¡®è®¤ï¼Œç›´æ¥å‡çº§

```bash
pub_upgrade --yes
```

### å‡çº§ä½†ä¸æäº¤ï¼ˆåªæ”¹æ–‡ä»¶ï¼‰

```bash
pub_upgrade --no-commit
```

### æŒ‡å®šç§æœåŸŸåï¼ˆå¯å¤šæ¬¡ï¼‰

```bash
pub_upgrade --private-host dart.cloudsmith.io --private-host my.private.repo
```

### è·³è¿‡æŒ‡å®šåŒ…

```bash
pub_upgrade --skip ap_recaptcha --skip some_internal_pkg
```

---

## è¾“å‡ºç¤ºä¾‹

```text
ğŸ“Œ é¡¹ç›®ç‰ˆæœ¬ï¼š3.45.1
ğŸ“Œ ä¾èµ–å‡çº§ä¸Šé™ï¼š< 3.46.0

å‘ç°ä»¥ä¸‹å¯å‡çº§ä¾èµ–ï¼š
  - ap_device: ^3.45.2 â†’ 3.45.10
  - ap_theme:  3.45.0  â†’ 3.45.6

æ˜¯å¦æ‰§è¡Œå‡çº§ï¼Ÿ(y/N):
```

å‡çº§å®Œæˆåï¼š

- `pubspec.yaml` ä¼šè¢«ç²¾ç¡®ä¿®æ”¹ï¼ˆä¸ç ´åæ³¨é‡Š/ç»“æ„ï¼‰
- `pubspec.lock` é€šè¿‡ `flutter pub get` æ›´æ–°
- é»˜è®¤ç”Ÿæˆ git commitï¼ŒåŒ…å«å‡çº§æ‘˜è¦

---

## è¿”å›ç ï¼ˆExit Codesï¼‰

| è¿”å›ç  | å«ä¹‰ |
|----|----|
| 0 | æˆåŠŸ / æ— å¯å‡çº§é¡¹ / ç”¨æˆ·å–æ¶ˆ |
| 1 | æ‰§è¡Œå¤±è´¥ï¼ˆpub / git / è§£æé”™è¯¯ï¼‰ |
| 130 | Ctrl+C ä¸­æ–­ |

---

## å¸¸è§é—®é¢˜

### ä¸ºä»€ä¹ˆæŸä¸ªä¾èµ–æ²¡æœ‰å‡çº§ï¼Ÿ

å¸¸è§åŸå› ï¼š

- æ‰€æœ‰å¯ç”¨ç‰ˆæœ¬éƒ½ `>= ä¸‹ä¸€ minor.0`
- ä¾èµ–ä¸æ˜¯ hosted + url
- è¢« `--skip` æ˜¾å¼è·³è¿‡
- `pub outdated` æ²¡æœ‰è¿”å›å¯è¾¾ç‰ˆæœ¬

### ä¸ºä»€ä¹ˆ latest æ²¡æœ‰è¢«é€‰ä¸­ï¼Ÿ

å› ä¸ºï¼š

> **latest å¯èƒ½å·²ç»è·¨ minorï¼ˆä¾‹å¦‚ 3.46.0ï¼‰**  
> `pub_upgrade` ä¼šè‡ªåŠ¨å›é€€é€‰æ‹© **ä»åœ¨å…è®¸èŒƒå›´å†…çš„æœ€é«˜ç‰ˆæœ¬**

---

## è®¾è®¡ç†å¿µï¼ˆä¸€å¥è¯ï¼‰

> **ä¾èµ–å¯ä»¥å¤§èƒ†å‡çº§ï¼Œä½†ç”Ÿå‘½å‘¨æœŸè¾¹ç•Œå¿…é¡»ç»å¯¹ä¿å®ˆã€‚**

---

## License

MIT
